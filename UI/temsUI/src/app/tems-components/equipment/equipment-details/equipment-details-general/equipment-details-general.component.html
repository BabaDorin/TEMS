<ng-container *ngIf="equipment==undefined">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
</ng-container>

<ng-container *ngIf="equipment!=undefined">
    <div [class]="headerClass">
        <br>
        <h1>{{ equipment.identifier }}
            <b *ngIf="equipment.temsID != undefined"> {{ equipment.temsID }}</b>
            <b *ngIf="equipment.temsID == undefined && equipment.serialNumber != undefined">{{ equipment.serialNumber}}</b>
        </h1>
        <ng-container *ngIf="canManage">
            <button mat-button (click)="edit()">Edit</button>
            <button *ngIf="equipment.isArchieved" mat-button (click)="archieve()" [disabled]="editing">Dearchieve</button>
            <button *ngIf="!equipment.isArchieved" mat-button (click)="archieve()" [disabled]="editing">Archieve</button>
            <button mat-button (click)="changeState('isDefect')" [disabled]="editing">
                <p *ngIf="equipment.isDefect == true">Mark as working</p>
                <p *ngIf="equipment.isDefect == false">Mark as defect</p>
                <p>Attach an equipment</p>
            </button>
            <button mat-button (click)="changeState('isUsed')" [disabled]="editing">
                <p *ngIf="equipment.isUsed == true">Mark as unused</p>
                <p *ngIf="equipment.isUsed == false">Mark as used</p>
            </button>
        </ng-container>
        <hr>
        <br>
        <ng-container *ngIf="editing == false">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-sm-12">
                        <!-- Common properties for each equipment go here -->
                        <app-property-render [(properties)]="generalProperties"></app-property-render>
                    </div>
                    <div class="col-md-6 col-sm-12">
                        <!-- Speciic properties for current equipment go here -->
                        <app-property-render [properties]="equipment.specificTypeProperties"></app-property-render>
                    </div>
                </div>
            </div>
            <br>
            <br>
            <ng-container *ngIf="equipment.children != undefined && equipment.children.length > 0">
                <h2>Equipment's Children</h2>
                <button *ngIf="canManage" mat-button><mat-icon class="text-primary">add</mat-icon> Attach</button>
                <div *ngFor="let child of equipment.children; let i = index">
                    <mat-expansion-panel>
                        <mat-expansion-panel-header>
                            <b>{{ child.additional }}: </b> {{ child.label }} 
                            <button mat-button (click)="detach(child.value, i)">
                                <mat-icon class="text-danger">exclude</mat-icon> Detach
                            </button>
                        </mat-expansion-panel-header>
    
                        <ng-container matExpansionPanelContent class="mat-exp-panel-content">
                            <app-equipment-details [equipmentId]="child.value"></app-equipment-details>
                        </ng-container>
                    </mat-expansion-panel>
                    <br>
                </div>
            </ng-container>
            <ng-container *ngIf="detachedEquipments.length > 0">
                <h2 class="text-muted">Detached equipments (These will dissapear after a refresh)</h2>
                <div *ngFor="let detachedEq of detachedEquipments">
                    <mat-expansion-panel>
                        <mat-expansion-panel-header>
                            <b>{{ detachedEq.additional }}: </b> {{ detachedEq.label }}
                        </mat-expansion-panel-header>

                        <ng-container matExpansionPanelContent class="mat-exp-panel-content">
                            <app-equipment-details [equipmentId]="detachedEq.value"></app-equipment-details>
                        </ng-container>
                    </mat-expansion-panel>
                    <br>
                </div>
            </ng-container>
            <!-- <div class="container" *ngIf="equipment.photos.length > 0">
                <h4>Equipment Images</h4>
                <app-image-carousel></app-image-carousel>
            </div> -->
            <br>
        </ng-container>
    
        <app-add-equipment *ngIf="editing==true"
        [updateEquipmentId]="equipment.id"
        (goBack)="ngOnInit(); editing = false;"
        [updateEquipmentDefinitionId]="equipment.definition.value">
            Loading...
        </app-add-equipment>
    
        <a *ngIf="displayViewMore == true" mat-button [routerLink]="'/equipment/details/' + equipment.id" (click)="viewMore()">View More</a>
    </div>
</ng-container>