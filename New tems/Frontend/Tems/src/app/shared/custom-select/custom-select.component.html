<div class="relative w-full">
  <div 
    (click)="toggleDropdown()"
    class="min-h-[44px] px-3 py-2 bg-white border border-gray-200 rounded-xl cursor-pointer hover:border-[#007aff] transition flex items-center justify-between"
    [class.border-[#007aff]]="isOpen"
    [class.ring-2]="isOpen"
    [class.ring-[#007aff]/20]="isOpen"
    [class.opacity-50]="disabled"
    [class.cursor-not-allowed]="disabled">
    <span [class.text-gray-400]="!selectedValue" [class.text-gray-900]="selectedValue" [class.font-medium]="selectedValue" class="text-sm">
      {{ selectedLabel }}
    </span>
    <svg width="12" height="8" viewBox="0 0 12 8" fill="none" class="ml-2 transition-transform duration-200 text-gray-600" [class.rotate-180]="isOpen">
      <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  
  <div *ngIf="isOpen" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-64 overflow-hidden">
    <div *ngIf="searchable" class="p-2 border-b border-gray-200">
      <input 
        type="text" 
        [(ngModel)]="searchText" 
        (click)="$event.stopPropagation()" 
        placeholder="Search..." 
        class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#007aff] focus:border-transparent">
    </div>
    <div class="max-h-52 overflow-y-auto">
      <div 
        *ngIf="allowEmpty"
        (click)="selectOption(''); $event.stopPropagation()" 
        class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100" 
        [class.bg-[#007aff]/5]="isSelected('')">
        <div class="w-5 h-5 flex-shrink-0 border-2 flex items-center justify-center transition"
          [class.rounded-full]="mode === 'single'"
          [class.rounded]="mode === 'multiple'"
          [class.border-[#007aff]]="isSelected('')" 
          [class.bg-[#007aff]]="isSelected('')" 
          [class.border-gray-300]="!isSelected('')">
          <svg *ngIf="isSelected('')" width="12" height="12" viewBox="0 0 12 12" fill="none">
            <path d="M2 6L5 9L10 3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span class="text-sm text-gray-900">{{ emptyLabel }}</span>
      </div>
      <div 
        *ngFor="let option of filteredOptions; trackBy: trackByValue" 
        (click)="selectOption(option.value); $event.stopPropagation()" 
        class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0" 
        [class.bg-[#007aff]/5]="isSelected(option.value)">
        <div class="w-5 h-5 flex-shrink-0 border-2 flex items-center justify-center transition"
          [class.rounded-full]="mode === 'single'"
          [class.rounded]="mode === 'multiple'"
          [class.border-[#007aff]]="isSelected(option.value)" 
          [class.bg-[#007aff]]="isSelected(option.value)" 
          [class.border-gray-300]="!isSelected(option.value)">
          <svg *ngIf="isSelected(option.value)" width="12" height="12" viewBox="0 0 12 12" fill="none">
            <path d="M2 6L5 9L10 3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span class="text-sm text-gray-900">{{ option.label }}</span>
      </div>
    </div>
  </div>
</div>
