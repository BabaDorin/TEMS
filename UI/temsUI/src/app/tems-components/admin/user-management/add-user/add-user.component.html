<ng-container *ngIf="formlyData.isVisible == true; else elseBlock">
    <h3>Add User</h3>
    <form [formGroup]="formlyData.form" (ngSubmit)="onSubmit()">
        <formly-form [form]="formlyData.form" [fields]="formlyData.fields" [model]="formlyData.model"></formly-form>

        <app-chips-autocomplete 
            #rolesChips label="Assign roles" [autocompleteOptions]="roleOptions"
            (dataCollected)="markRoleClaims()" (dataRemoved)="markRoleClaims(true)">
        </app-chips-autocomplete>
        <br>

        <app-chips-autocomplete #personnelChips label="Assign personnel record to this user if any"
            [endPoint]="personnelService" maxOptionsSelected="1">
        </app-chips-autocomplete>

        <div class="mt-2">
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h3 class="m-2">
                            User's Claims
                        </h3>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <ng-template matExpansionPanelContent>
                    <app-checkbox-group [options]="claims"
                        label="Select new user claims (Role's claims will set anyways)"
                        (toggle)="onClaimsChange($event)">
                    </app-checkbox-group>
                </ng-template>
            </mat-expansion-panel>
        </div>

        <button type="submit" class="btn btn-gradient-primary mt-2" [disabled]="formlyData.form.status=='INVALID'">
            Submit
        </button>
    </form>
</ng-container>

<ng-template #elseBlock>
    Preparing...
</ng-template>