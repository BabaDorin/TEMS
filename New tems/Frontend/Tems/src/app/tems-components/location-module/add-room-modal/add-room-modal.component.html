<div [ngClass]="dialogRef ? 'bg-white dark:bg-[#2c2c2e]' : 'bg-[#f5f5f7] dark:bg-[#1c1c1e] min-h-screen p-4'">
  <div class="max-w-4xl mx-auto" [ngClass]="{'px-4 py-2': dialogRef}">
    
    <!-- Header (modal and full page mode) -->
    <div class="mb-4">
      <div class="flex items-center justify-between gap-4">
        <div class="flex-1">
          <h1 class="text-2xl font-semibold text-gray-900 dark:text-white m-0" style="letter-spacing: -0.5px;">Add New Room</h1>
          <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 m-0">Fill in the details to add a new room to the system</p>
        </div>
        <button 
          *ngIf="dialogRef"
          (click)="openInFullPage()"
          class="px-2.5 py-1.5 text-xs text-gray-500 dark:text-gray-400 hover:text-[#007aff] hover:bg-[#007aff]/5 rounded-lg transition flex items-center gap-1.5 flex-shrink-0"
          title="Open in Full Page">
          <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
            <path d="M6 2H3C2.44772 2 2 2.44772 2 3V13C2 13.5523 2.44772 14 3 14H13C13.5523 14 14 13.5523 14 13V10M9 2H14M14 2V7M14 2L7 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Open in Full Page</span>
        </button>
      </div>
    </div>

    <!-- Main Form -->
    <div class="space-y-4">
      
      <!-- Step 1: Select Site -->
      <div class="bg-white dark:bg-[#2c2c2e] rounded-xl border border-gray-200 dark:border-[#48484a]">
        <div class="px-4 py-3">
          <div class="flex items-start justify-between gap-4 mb-3">
            <div class="flex-1">
              <h3 class="text-sm font-medium text-gray-900 dark:text-white m-0">Step 1: Select Site</h3>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5 m-0">Choose the site where the room will be located</p>
            </div>
            <div class="flex-shrink-0 mt-0.5">
              <div class="flex items-center gap-1.5 px-2 py-1 bg-blue-50 rounded-md">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="text-blue-600">
                  <circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M6 4V6.5M6 8.5V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span class="text-xs font-medium text-blue-600">Required</span>
              </div>
            </div>
          </div>
          <div class="max-w-xl">
            <app-custom-select
              [options]="siteOptions"
              [mode]="'single'"
              [searchable]="sites.length > 5"
              placeholder="Select site"
              [(ngModel)]="selectedSite"
              (ngModelChange)="onSiteChange($event)">
            </app-custom-select>
          </div>
        </div>
      </div>

      <!-- Step 2: Select Building -->
      <div *ngIf="selectedSite" class="bg-white dark:bg-[#2c2c2e] rounded-xl border border-gray-200 dark:border-[#48484a]" @expandCollapse>
        <div class="px-4 py-3">
          <div class="flex items-start justify-between gap-4 mb-3">
            <div class="flex-1">
              <h3 class="text-sm font-medium text-gray-900 dark:text-white m-0">Step 2: Select Building</h3>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5 m-0">Choose the building for the room</p>
            </div>
            <div class="flex-shrink-0 mt-0.5">
              <div class="flex items-center gap-1.5 px-2 py-1 bg-blue-50 rounded-md">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="text-blue-600">
                  <circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M6 4V6.5M6 8.5V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span class="text-xs font-medium text-blue-600">Required</span>
              </div>
            </div>
          </div>
          <div class="max-w-xl">
            <app-custom-select
              [options]="buildingOptions"
              [mode]="'single'"
              [searchable]="buildings.length > 5"
              placeholder="Select building"
              [(ngModel)]="selectedBuilding"
              (ngModelChange)="onBuildingChange($event)">
            </app-custom-select>
          </div>
        </div>
      </div>

      <!-- Step 3: Room Details -->
      <div *ngIf="selectedBuilding" class="bg-white dark:bg-[#2c2c2e] rounded-xl border border-gray-200 dark:border-[#48484a]" @expandCollapse>
        <div class="px-4 py-3 border-b border-gray-200 dark:border-[#48484a]">
          <h3 class="text-sm font-medium text-gray-900 dark:text-white m-0">Step 3: Room Details</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5 m-0">Enter the room information</p>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- Room Name -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Room Name *</label>
              <input 
                type="text" 
                [(ngModel)]="roomName"
                placeholder="e.g., Conference Room A"
                class="w-full px-3 py-2 border border-gray-200 dark:border-[#48484a] dark:bg-[#3a3a3c] dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#007aff] focus:border-transparent text-sm">
            </div>

            <!-- Room Number -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Room Number</label>
              <input 
                type="text" 
                [(ngModel)]="roomNumber"
                placeholder="e.g., 101"
                class="w-full px-3 py-2 border border-gray-200 dark:border-[#48484a] dark:bg-[#3a3a3c] dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#007aff] focus:border-transparent text-sm">
            </div>

            <!-- Floor -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Floor *</label>
              <input 
                type="number" 
                [(ngModel)]="floor"
                placeholder="e.g., 1"
                class="w-full px-3 py-2 border border-gray-200 dark:border-[#48484a] dark:bg-[#3a3a3c] dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#007aff] focus:border-transparent text-sm">
            </div>

            <!-- Room Type -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Room Type *</label>
              <app-custom-select
                [options]="roomTypeOptions"
                [mode]="'single'"
                [searchable]="false"
                placeholder="Select room type"
                [(ngModel)]="roomType"
                (ngModelChange)="onRoomTypeChange($event)">
              </app-custom-select>
            </div>

            <!-- Capacity -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Capacity</label>
              <input 
                type="number" 
                [(ngModel)]="capacity"
                placeholder="e.g., 10"
                class="w-full px-3 py-2 border border-gray-200 dark:border-[#48484a] dark:bg-[#3a3a3c] dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#007aff] focus:border-transparent text-sm">
            </div>
          </div>

          <!-- Description (Full Width) -->
          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
            <textarea 
              [(ngModel)]="description"
              rows="3"
              placeholder="Additional information about the room..."
              class="w-full px-3 py-2 border border-gray-200 dark:border-[#48484a] dark:bg-[#3a3a3c] dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#007aff] focus:border-transparent text-sm resize-none"></textarea>
          </div>
        </div>
      </div>

      <!-- Submit Button Section -->
      <div *ngIf="selectedBuilding" class="flex items-center justify-end gap-2 pt-2" @expandCollapse>
        <button 
          *ngIf="dialogRef"
          (click)="close()"
          class="px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-white/10 rounded-lg transition">
          Cancel
        </button>
        <button 
          (click)="saveRoom()"
          [disabled]="!canSaveRoom() || isSaving"
          class="px-4 py-2 text-sm bg-[#007aff] text-white rounded-lg hover:bg-[#0051d5] disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center gap-2">
          <svg *ngIf="isSaving" class="animate-spin h-4 w-4" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          {{ isSaving ? 'Saving...' : 'Save Room' }}
        </button>
      </div>
    </div>
  </div>
</div>
