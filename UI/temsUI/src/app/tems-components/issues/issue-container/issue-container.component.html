<mat-expansion-panel
      class="m-2 mat-elevation-z0"
      hideToggle="true">
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{ issue.problem }}
          <label *ngIf="issue.status.label == 'Urgent'" class="badge-pill badge-gradient-danger ml-3">{{
            issue.status.label
            }}</label>
          <label *ngIf="issue.status.label == 'Medium'" class="badge-pill badge-gradient-warning ml-3">{{
            issue.status.label
            }}</label>
          <label *ngIf="issue.status.label == 'Future'" class="badge-pill badge-gradient-info ml-3">{{ issue.status.label
            }}</label>
          <label *ngIf="issue.dateClosed != undefined" class="badge-pill badge-gradient-secondary ml-3">Closed</label>
          <label *ngIf="issue.status.label == 'Progress'" class="badge-pill badge-gradient-primary ml-3">{{
            issue.status.label }}</label>
        </mat-panel-title>
        <mat-panel-description>
          {{ issue.dateCreated | date:'medium' }}
        </mat-panel-description>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <ng-container *ngIf="issue.dateClosed != undefined && issue.closedBy != undefined">
          <div class="alert alert-warning">
            <p>Closed on {{ issue.dateClosed | date:'short' }} by
              <a mat-button [routerLink]="'/profile/view/' + issue.closedBy.value">
                <mat-icon class="text-primary ml-3" (click)="wtf(issue)">person</mat-icon>
                {{ issue.closedBy.label }}
              </a>
            </p>
          </div>
        </ng-container>
        <ng-container *ngIf="!readonly && issue.dateClosed == undefined">
          <mat-form-field appearance="fill">
            <mat-label>Change issue status</mat-label>
            <mat-select (selectionChange)="issueStatusChanged($event)">
              <mat-option *ngFor="let status of statuses" [value]="status">
                {{ status.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </ng-container>
        <div *ngIf="issue.description != undefined">
          <h4>Description:</h4>
          <hr>
          <p>{{ issue.description }}</p>
        </div>
        <br>
        <div *ngIf="issue.equipments != undefined && issue.equipments.length > 0" class="mb-4">
          <h4>Equipments involved:</h4>
          <hr>
          <div class="alert alert-info">
            <a mat-button *ngFor="let eq of issue.equipments" [routerLink]="'/equipment/details/' + eq.value">
              <mat-icon class="text-primary">computer</mat-icon>
              {{ eq.label }} {{ eq.additional }}
            </a>
          </div>
        </div>
        <div *ngIf="issue.rooms != undefined && issue.rooms.length > 0" class="mb-4">
          <h4>Rooms involved:</h4>
          <hr>
          <div class="alert alert-info">
            <a mat-button *ngFor="let rm of issue.rooms" [routerLink]="'/rooms/details/' + rm.value">
              <mat-icon class="text-primary">pin_drop</mat-icon>
              {{ rm.label }} {{ rm.additional }}
            </a>
          </div>
        </div>
        <div *ngIf="issue.personnel != undefined && issue.personnel.length > 0" class="mb-4">
          <h4>Personnel involved:</h4>
          <hr>
          <div class="alert alert-info">
            <a mat-button *ngFor="let pr of issue.personnel" [routerLink]="'/personnel/details/' + pr.value">
              <mat-icon class="text-primary">account_circle</mat-icon>
              {{ pr.label }} {{ pr.additional }}
            </a>
          </div>
        </div>
        <div *ngIf="issue.assignees != undefined && issue.assignees.length > 0" class="mb-4">
          <h4>Assigned to:</h4>
          <hr>
          <div class="alert alert-warning">
            <a mat-button *ngFor="let assignee of issue.assignees" [routerLink]="'/profile/view/' + assignee.value">
              <mat-icon class="text-primary">account_circle</mat-icon>
              {{ assignee.label }}
            </a>
          </div>
        </div>
        <br>
        
        <ng-container *ngIf="!readonly">
          <button mat-button (click)="solveIssue()" *ngIf="issue.dateClosed == undefined">
            <mat-icon class="text-primary">done</mat-icon>Mark as solved
          </button>
          <button mat-button (click)="reopenIssue()" *ngIf="issue.dateClosed != undefined">
            <mat-icon class="text-secondary">restore</mat-icon>Reopen
          </button>
          <button mat-button (click)="removeIssue()">
            <mat-icon class="text-danger">delete</mat-icon>Remove
          </button>
        </ng-container>
      </ng-template>
    </mat-expansion-panel>